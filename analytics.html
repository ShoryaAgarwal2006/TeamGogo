<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#6c63ff" />
    <meta name="description"
        content="CivicPulse Analytics â€” Public transparency feed, ward rankings, and infrastructure heatmap." />
    <title>CivicPulse â€” Transparency & Analytics</title>
    <link rel="manifest" href="manifest.json" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" href="analytics.css" />
</head>

<body>

    <!-- Toast -->
    <div id="toast" class="toast" aria-live="polite" hidden>
        <span id="toast-icon">âœ…</span>
        <span id="toast-msg">Done</span>
    </div>

    <!-- Header -->
    <header class="app-header">
        <div class="header-inner">
            <div class="logo">
                <span class="logo-icon">ğŸ›ï¸</span>
                <div>
                    <span class="logo-name">CivicPulse</span>
                    <span class="logo-tagline">Transparency & Analytics</span>
                </div>
            </div>
            <nav class="header-nav-right">
                <a href="/" class="nav-pill">ğŸ“‹ Report</a>
                <a href="/dashboard.html" class="nav-pill">ğŸ“Š Dashboard</a>
                <span class="badge-phase4">Phase 4</span>
                <span id="online-dot" class="online-dot"></span>
            </nav>
        </div>
    </header>

    <!-- Tab bar -->
    <div class="tab-bar">
        <button class="tab active" id="tab-feed" data-tab="feed">
            <span class="tab-icon">ğŸ”</span> Public Feed
        </button>
        <button class="tab" id="tab-rankings" data-tab="rankings">
            <span class="tab-icon">ğŸ†</span> Ward Rankings
        </button>
        <button class="tab" id="tab-heatmap" data-tab="heatmap">
            <span class="tab-icon">ğŸŒ¡ï¸</span> Heatmap
        </button>
        <button class="tab" id="tab-nearby" data-tab="nearby">
            <span class="tab-icon">ğŸ“</span> Nearby Reports
        </button>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 1: PUBLIC FEED
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section id="panel-feed" class="tab-panel active">
        <div class="panel-header">
            <h2 class="panel-title">Public Proof Feed</h2>
            <p class="panel-sub">Every resolved issue includes GPS-verified before &amp; after photos. Citizens vote to
                accept or reject the resolution.</p>
        </div>
        <div id="feed-grid" class="feed-grid">
            <div class="loading-state" id="feed-loading">
                <div class="loading-spinner"></div>
                <p>Loading resolved reportsâ€¦</p>
            </div>
        </div>
        <p id="feed-empty" class="empty-state" hidden>No resolved reports yet â€” check back soon.</p>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 2: WARD RANKINGS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section id="panel-rankings" class="tab-panel" hidden>
        <div class="panel-header">
            <h2 class="panel-title">Ward Accountability Leaderboard</h2>
            <p class="panel-sub">Real-time ranking using:
                <code>Score = (ResolutionRate Ã— 0.6) + (AvgResponseTimeScore Ã— 0.4)</code>
            </p>
        </div>
        <div id="ranking-table-wrap" class="ranking-wrap">
            <div class="loading-state" id="rankings-loading">
                <div class="loading-spinner"></div>
                <p>Computing rankingsâ€¦</p>
            </div>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 3: HEATMAP
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section id="panel-heatmap" class="tab-panel" hidden>
        <div class="panel-header">
            <h2 class="panel-title">Infrastructure Failure Heatmap</h2>
            <p class="panel-sub">Darker red = more reports from that location. Pinpoints where infrastructure needs
                replacement, not just repair.</p>
            <div class="heat-controls">
                <div class="heat-ctrl-group">
                    <label class="ctrl-lbl" for="cat-filter">Category</label>
                    <select id="cat-filter" class="ctrl-select">
                        <option value="all">All Categories</option>
                        <option value="pothole">ğŸ•³ï¸ Pothole</option>
                        <option value="streetlight">ğŸ’¡ Streetlight</option>
                        <option value="garbage">ğŸ—‘ï¸ Garbage</option>
                        <option value="graffiti">ğŸ¨ Graffiti</option>
                        <option value="flooding">ğŸŒŠ Flooding</option>
                        <option value="sidewalk">ğŸš¶ Sidewalk</option>
                    </select>
                </div>
                <div class="heat-ctrl-group">
                    <label class="ctrl-lbl" for="days-filter">Time Range</label>
                    <select id="days-filter" class="ctrl-select">
                        <option value="30">Last 30 days</option>
                        <option value="60">Last 60 days</option>
                        <option value="90" selected>Last 90 days</option>
                        <option value="365">Last year</option>
                    </select>
                </div>
                <button class="btn btn-secondary" id="apply-heat-btn">Apply</button>
                <div class="heat-stat">
                    <span id="heat-count">â€”</span> reports plotted
                </div>
            </div>
        </div>

        <div id="map" class="leaflet-map"></div>

        <!-- Repeat offenders panel -->
        <div class="repeat-offenders-wrap">
            <h3 class="ro-title">ğŸ”¥ Repeat Infrastructure Failure Hotspots</h3>
            <p class="ro-sub">Locations with 3+ incidents in the selected window â€” candidates for permanent
                infrastructure replacement.</p>
            <div id="ro-list" class="ro-list">
                <div class="loading-state" id="ro-loading">
                    <div class="loading-spinner"></div>
                    <p>Detecting hotspotsâ€¦</p>
                </div>
            </div>
            <p id="ro-empty" class="empty-state" hidden>No repeat offenders in this time window. ğŸ‰</p>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 4: NEARBY REPORTS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section id="panel-nearby" class="tab-panel" hidden>
        <div class="panel-header">
            <h2 class="panel-title">Reports Near You</h2>
            <p class="panel-sub">See all active civic reports within your vicinity. Allow GPS to see nearby issues
                reported by your community.</p>
        </div>
        <div class="nearby-controls-bar" id="nearby-controls-bar" hidden>
            <div class="nearby-radius-ctrl">
                <label>Radius: <span id="nearby-radius-val">500</span>m</label>
                <input type="range" id="nearby-radius-slider" min="100" max="5000" step="100" value="500" />
            </div>
            <span id="nearby-report-count" class="nearby-report-count"></span>
        </div>
        <div id="nearby-gps-status" class="nearby-gps-status">
            <div class="loading-spinner"></div>
            <p>ğŸ“¡ Acquiring your GPS locationâ€¦</p>
        </div>
        <div id="nearby-reports-grid" class="nearby-reports-grid"></div>
        <p id="nearby-empty" class="empty-state" hidden>No reports found within this radius. Try increasing the range.
        </p>
        <p id="nearby-gps-denied" class="empty-state" hidden>ğŸ“ GPS access denied. Please enable location services to
            see nearby reports.</p>
    </section>

    <footer class="app-footer">
        <p>CivicPulse Phase 4 Â· Resolution Proof Protocol Â· Citizen Acceptance Voting Â· Ward Rankings Â· Heatmap
            Analytics Â· Nearby Reports</p>
    </footer>

    <!-- Leaflet + Heatmap.js -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

    <script type="module" src="analytics.js"></script>
</body>

</html>