<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#6c63ff" />
    <meta name="description"
        content="CivicPulse Accountability Dashboard â€” Real-time SLA monitoring, live tracking, ward performance, and emergency alerts." />
    <title>CivicPulse â€” Accountability Dashboard</title>
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="index.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="dashboard.css" />
</head>

<body>

    <!-- Offline Banner -->
    <div id="offline-banner" class="offline-banner" aria-live="polite" hidden>
        <span class="offline-icon">ğŸ“¡</span>
        <span>You're offline â€” dashboard data may be stale</span>
    </div>

    <!-- Toast -->
    <div id="dash-toast" class="toast" aria-live="polite" hidden>
        <span class="toast-icon">âœ…</span>
        <span id="dash-toast-msg">Done</span>
    </div>

    <!-- Header -->
    <header class="app-header">
        <div class="header-inner">
            <div class="logo">
                <span class="logo-icon">ğŸ›ï¸</span>
                <div>
                    <span class="logo-name">CivicPulse</span>
                    <span class="logo-tagline">Accountability Dashboard</span>
                </div>
            </div>
            <nav class="header-nav">
                <a href="/" class="nav-link">ğŸ“‹ Report Issue</a>
                <a href="/tracking.html" class="nav-link">ğŸ—ºï¸ Live Tracking</a>
                <a href="/analytics.html" class="nav-link">ğŸ” Transparency</a>
                <span class="badge badge-phase3">Live</span>
                <span id="sse-dot" class="sse-dot" title="Live feed disconnected">â¬¤</span>
                <span id="online-dot" class="online-dot"></span>
            </nav>
        </div>
    </header>

    <!-- Emergency Alert Banner -->
    <div id="emergency-banner" class="emergency-banner" hidden>
        <div class="emergency-inner">
            <span class="emergency-icon">ğŸš¨</span>
            <div class="emergency-content">
                <strong>EMERGENCY ALERTS</strong>
                <div id="emergency-list" class="emergency-ticker"></div>
            </div>
            <button id="emergency-dismiss" class="emergency-dismiss" aria-label="Dismiss">âœ•</button>
        </div>
    </div>

    <!-- Summary Stats -->
    <section class="dash-hero">
        <div class="dash-hero-bg"></div>
        <div class="dash-summary">
            <div class="summary-card" id="stat-total">
                <span class="stat-num" id="s-total">â€”</span>
                <span class="stat-lbl">Total Active</span>
            </div>
            <div class="summary-card stat-ok">
                <span class="stat-num" id="s-track">â€”</span>
                <span class="stat-lbl">âœ… On Track</span>
            </div>
            <div class="summary-card stat-warn">
                <span class="stat-num" id="s-warn">â€”</span>
                <span class="stat-lbl">âš ï¸ Warning (72h)</span>
            </div>
            <div class="summary-card stat-urgent">
                <span class="stat-num" id="s-urgent">â€”</span>
                <span class="stat-lbl">ğŸ”´ Urgent (120h)</span>
            </div>
            <div class="summary-card stat-critical">
                <span class="stat-num" id="s-crit">â€”</span>
                <span class="stat-lbl">ğŸš¨ Critical (168h)</span>
            </div>
            <div class="summary-card stat-emergency">
                <span class="stat-num" id="s-emerg">â€”</span>
                <span class="stat-lbl">âš¡ Emergency</span>
            </div>
        </div>
    </section>

    <!-- My Reports Section -->
    <section class="my-reports-section" id="my-reports-section">
        <div class="my-reports-header">
            <h2>ğŸ“‹ My Reports</h2>
            <span class="my-reports-count" id="my-reports-count"></span>
        </div>
        <div id="my-reports-grid" class="my-reports-grid">
            <div class="dash-loading" id="my-reports-loading">
                <div class="loading-spinner"></div>
                <p>Loading your reportsâ€¦</p>
            </div>
        </div>
        <p id="my-reports-empty" class="dash-empty" hidden>You haven't submitted any reports yet. <a href="/">Report an
                issue â†’</a></p>
    </section>

    <!-- Live Map Panel -->
    <section class="map-panel">
        <div class="map-panel-header">
            <h2>ğŸ—ºï¸ Live Issue Map</h2>
            <span class="map-subtitle">All active reports â€” click a pin for details</span>
        </div>
        <div id="dash-map" class="dash-map"></div>
    </section>

    <!-- Controls -->
    <div class="dash-controls">
        <div class="filter-group">
            <label class="filter-lbl">Filter by State</label>
            <div class="filter-pills">
                <button class="fpill active" data-filter="all" id="f-all">All</button>
                <button class="fpill" data-filter="SUBMITTED" id="f-sub">Submitted</button>
                <button class="fpill" data-filter="VERIFIED" id="f-ver">Verified</button>
                <button class="fpill" data-filter="ASSIGNED" id="f-asgn">Assigned</button>
                <button class="fpill" data-filter="IN_PROGRESS" id="f-ip">In Progress</button>
                <button class="fpill" data-filter="RESOLVED" id="f-res">Resolved</button>
            </div>
        </div>
        <div class="filter-group">
            <label class="filter-lbl">Severity</label>
            <div class="filter-pills">
                <button class="fpill-sev active" data-sev="all">All</button>
                <button class="fpill-sev" data-sev="critical">ğŸ”¥ Critical</button>
                <button class="fpill-sev" data-sev="high">ğŸ”´ High</button>
                <button class="fpill-sev" data-sev="medium">ğŸŸ¡ Medium</button>
                <button class="fpill-sev" data-sev="low">ğŸŸ¢ Low</button>
            </div>
        </div>
        <div class="refresh-group">
            <span id="last-updated" class="last-updated">â€”</span>
            <button id="refresh-btn" class="btn-refresh" title="Refresh dashboard">ğŸ”„ Refresh</button>
        </div>
    </div>

    <!-- Nearby Complaints -->
    <div class="nearby-section" id="nearby-section" hidden>
        <div class="nearby-header">
            <h3>ğŸ“ Complaints Near You</h3>
            <div class="nearby-controls">
                <label>Radius: <span id="radius-val">500</span>m</label>
                <input type="range" id="radius-slider" min="100" max="3000" step="100" value="500" />
            </div>
        </div>
        <div id="nearby-list" class="nearby-list"></div>
    </div>

    <!-- Dashboard Grid -->
    <main class="dash-grid-wrap">
        <div id="dash-grid" class="dash-grid">
            <div class="dash-loading" id="dash-loading">
                <div class="loading-spinner"></div>
                <p>Loading reportsâ€¦</p>
            </div>
        </div>
        <p id="dash-empty" class="dash-empty" hidden>No reports found matching this filter.</p>
    </main>

    <!-- Ward Performance Table -->
    <section class="ward-perf-section">
        <div class="ward-perf-header">
            <h2>ğŸ“Š Ward Performance</h2>
            <span class="ward-perf-subtitle">Resolution time, escalation rate, and on-time %</span>
        </div>
        <div id="ward-table-wrap" class="ward-table-wrap">
            <div class="dash-loading">
                <div class="loading-spinner"></div>
                <p>Loading ward dataâ€¦</p>
            </div>
        </div>
    </section>

    <!-- Issue Detail Modal (with Chat + Timeline tabs) -->
    <div id="issue-modal" class="modal-overlay" hidden>
        <div class="modal-card glass-card modal-wide">
            <div class="modal-header">
                <span class="modal-icon" id="modal-icon">ğŸ“‹</span>
                <div class="modal-title-block">
                    <span class="modal-title" id="modal-title">Issue Details</span>
                    <span class="modal-sub" id="modal-sub">â€”</span>
                </div>
                <button class="modal-close" id="modal-close" aria-label="Close">âœ•</button>
            </div>

            <!-- Tabs -->
            <div class="modal-tabs">
                <button class="modal-tab active" data-tab="transition">ğŸ”§ Action</button>
                <button class="modal-tab" data-tab="timeline">ğŸ“… Timeline</button>
                <button class="modal-tab" data-tab="chat">ğŸ’¬ Chat</button>
            </div>

            <!-- Tab: Transition -->
            <div class="modal-tab-content active" id="tab-transition">
                <div id="modal-geo-warning" class="geo-warning" hidden>
                    <span>ğŸ“</span>
                    <span>Acquiring your GPS â€” required to confirm you are on-site (within 100m).</span>
                </div>
                <div id="modal-geo-error" class="geo-error" hidden>
                    <span>âš ï¸</span>
                    <span id="modal-geo-error-msg">GPS unavailable.</span>
                </div>
                <div class="modal-actions">
                    <button id="modal-confirm" class="btn btn-primary" disabled>
                        <span id="modal-confirm-icon">âœ…</span>
                        <span id="modal-confirm-label">Confirm Transition</span>
                    </button>
                    <button id="modal-cancel" class="btn btn-secondary">Cancel</button>
                </div>
            </div>

            <!-- Tab: Timeline -->
            <div class="modal-tab-content" id="tab-timeline" hidden>
                <div id="timeline-list" class="timeline-list">
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <!-- Tab: Chat -->
            <div class="modal-tab-content" id="tab-chat" hidden>
                <div id="chat-messages" class="chat-messages"></div>
                <div class="chat-input-row">
                    <select id="chat-role" class="chat-role-sel">
                        <option value="citizen">ğŸ‘¤ Citizen</option>
                        <option value="authority">ğŸ›ï¸ Authority</option>
                    </select>
                    <input type="text" id="chat-name" placeholder="Your name" class="chat-name-input" maxlength="50" />
                    <input type="text" id="chat-input" placeholder="Type a messageâ€¦" class="chat-input"
                        maxlength="500" />
                    <button id="chat-send" class="btn btn-primary btn-sm">Send</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="app-footer">
        <p>CivicPulse Phase 5 Â· Live GPS Tracking Â· Auto-Escalation Â· Citizen Verification Â· Chat</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module" src="dashboard.js"></script>
</body>

</html>